/**
 * Mobile Chat App Layout - iMessage/WhatsApp Style
 * 
 * Full-screen mobile experience:
 * - Sticky header with blur
 * - Scrollable message list
 * - Sticky composer at bottom
 * - Safe area support for iOS
 */

/* ============================================
   MOBILE FULL-SCREEN CHAT LAYOUT
   ============================================ */

@media (max-width: 767px) {
  /* Force full-screen layout on mobile */
  .messaging-interface {
    height: 100dvh !important;
    min-height: 100dvh !important;
    max-height: 100dvh !important;
    display: flex !important;
    flex-direction: column !important;
    background: #F8FAFC !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Remove card styling on mobile - full screen */
  .messaging-column--center .tailadmin-card,
  .messaging-column--center > .tailadmin-card {
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: transparent !important;
  }

  /* Chat container wrapper - full height flex */
  .chat-container-wrapper {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    background: #F8FAFC !important;
    border-radius: 0 !important;
    overflow: hidden !important;
  }

  /* ============================================
     MOBILE HEADER - Sticky with blur
     ============================================ */
  
  .mobile-chat-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 50 !important;
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    border-bottom: 1px solid #E2E8F0 !important;
    padding: env(safe-area-inset-top, 0) 12px 0 12px !important;
    flex-shrink: 0 !important;
  }

  .mobile-chat-header-inner {
    height: 56px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  /* Back button */
  .mobile-nav-btn--back {
    height: 40px !important;
    width: 40px !important;
    min-width: 40px !important;
    display: grid !important;
    place-items: center !important;
    border-radius: 50% !important;
    background: transparent !important;
    border: none !important;
    color: #1F2937 !important;
    padding: 0 !important;
  }

  .mobile-nav-btn--back:active {
    background: #F1F5F9 !important;
  }

  .mobile-nav-btn--back span {
    display: none !important; /* Hide text, icon only */
  }

  /* Avatar in header */
  .mobile-header-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #E2E8F0;
    flex-shrink: 0;
    object-fit: cover;
  }

  /* Fan info in header */
  .mobile-header-info {
    flex: 1;
    min-width: 0;
    line-height: 1.3;
  }

  .mobile-header-name {
    font-size: 15px;
    font-weight: 600;
    color: #0F172A;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .mobile-header-status {
    font-size: 12px;
    color: #64748B;
  }

  /* Notes button */
  .mobile-nav-btn--notes {
    height: 40px !important;
    padding: 0 16px !important;
    border-radius: 20px !important;
    border: 1px solid #E2E8F0 !important;
    background: transparent !important;
    font-size: 13px !important;
    font-weight: 500 !important;
    color: #334155 !important;
  }

  .mobile-nav-btn--notes:active {
    background: #F1F5F9 !important;
  }

  .mobile-nav-btn--notes svg {
    display: none !important; /* Hide icon, text only */
  }

  /* ============================================
     MESSAGE LIST - Scrollable area
     ============================================ */

  .chat-messages-scroll {
    flex: 1 !important;
    min-height: 0 !important; /* CRITICAL for flex scroll */
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: 12px 16px !important;
    background: #F8FAFC !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Messages container - justify-end for short conversations */
  .chat-messages-scroll > div:first-of-type {
    margin-top: auto !important;
  }

  /* Hide the library header on mobile - we use our own */
  .chat-container-wrapper .cs-conversation-header {
    display: none !important;
  }

  /* ============================================
     MESSAGE BUBBLES - iMessage style
     ============================================ */

  .message-row {
    display: flex !important;
    width: 100% !important;
    margin-bottom: 4px !important;
    padding: 0 !important;
  }

  .message-row--incoming {
    justify-content: flex-start !important;
  }

  .message-row--outgoing {
    justify-content: flex-end !important;
  }

  .message-bubble {
    max-width: 78% !important;
    padding: 10px 14px !important;
    font-size: 15px !important;
    line-height: 1.35 !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
  }

  .message-bubble--incoming {
    background: #F1F5F9 !important;
    color: #0F172A !important;
    border: none !important;
    border-radius: 20px 20px 20px 6px !important;
  }

  .message-bubble--outgoing {
    background: #0F172A !important;
    color: #FFFFFF !important;
    border: none !important;
    border-radius: 20px 20px 6px 20px !important;
  }

  /* Message grouping - tighter spacing for same sender */
  .message-row + .message-row--incoming .message-bubble--incoming,
  .message-row + .message-row--outgoing .message-bubble--outgoing {
    margin-top: -2px;
  }

  /* ============================================
     COMPOSER - Sticky bottom with safe area
     ============================================ */

  .custom-message-input {
    position: sticky !important;
    bottom: 0 !important;
    z-index: 50 !important;
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    border-top: 1px solid #E2E8F0 !important;
    padding: 8px 12px calc(env(safe-area-inset-bottom, 12px) + 8px) 12px !important;
    flex-shrink: 0 !important;
  }

  .custom-message-input__wrapper {
    display: flex !important;
    align-items: flex-end !important;
    gap: 8px !important;
    background: #F1F5F9 !important;
    border: none !important;
    border-radius: 24px !important;
    padding: 8px 12px !important;
  }

  .custom-message-input__wrapper:focus-within {
    background: #E2E8F0 !important;
  }

  /* Attach button */
  .custom-message-input__attach-btn {
    width: 40px !important;
    height: 40px !important;
    min-width: 40px !important;
    display: grid !important;
    place-items: center !important;
    border-radius: 50% !important;
    border: none !important;
    background: #FFFFFF !important;
    color: #64748B !important;
    flex-shrink: 0 !important;
  }

  .custom-message-input__attach-btn:active {
    background: #E2E8F0 !important;
  }

  /* Textarea */
  .custom-message-input__textarea {
    flex: 1 !important;
    min-width: 0 !important;
    background: transparent !important;
    border: none !important;
    outline: none !important;
    resize: none !important;
    font-size: 15px !important;
    line-height: 1.35 !important;
    color: #0F172A !important;
    padding: 8px 0 !important;
    max-height: calc(1.35em * 4) !important; /* 4 lines max */
  }

  .custom-message-input__textarea::placeholder {
    color: #94A3B8 !important;
  }

  /* Send button */
  .custom-message-input__send-btn {
    height: 40px !important;
    padding: 0 16px !important;
    border-radius: 20px !important;
    background: #0F172A !important;
    color: #FFFFFF !important;
    font-size: 14px !important;
    font-weight: 500 !important;
    border: none !important;
    flex-shrink: 0 !important;
    opacity: 0.4 !important;
    transition: opacity 0.15s ease !important;
  }

  .custom-message-input__send-btn--active,
  .custom-message-input__send-btn.icon-button--active {
    opacity: 1 !important;
  }

  .custom-message-input__send-btn:active {
    opacity: 0.8 !important;
  }

  /* AI Disclaimer - hidden on mobile, moved to Notes */
  .ai-disclaimer {
    display: none !important;
  }

  /* ============================================
     DATE SEPARATORS
     ============================================ */

  .date-separator {
    display: flex !important;
    justify-content: center !important;
    padding: 16px 0 12px 0 !important;
  }

  .date-separator__chip {
    font-size: 12px !important;
    font-weight: 500 !important;
    color: #64748B !important;
    background: #FFFFFF !important;
    border: 1px solid #E2E8F0 !important;
    border-radius: 12px !important;
    padding: 4px 12px !important;
  }

  /* ============================================
     TYPING INDICATOR
     ============================================ */

  .chat-typing-indicator {
    padding: 8px 0 !important;
  }

  .cs-typing-indicator {
    background: #F1F5F9 !important;
    border: none !important;
    border-radius: 16px !important;
    padding: 8px 12px !important;
    display: inline-flex !important;
  }
}

/* ============================================
   PREVENT BODY SCROLL ON MOBILE CHAT
   ============================================ */

@media (max-width: 767px) {
  body.onlyfans-messages-page {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    height: 100% !important;
  }

  body.onlyfans-messages-page #main-content {
    overflow: hidden !important;
  }
}
