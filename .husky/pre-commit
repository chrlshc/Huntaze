#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# VÃ©rifier les gros fichiers avant commit
echo "ðŸ” VÃ©rification des fichiers..."

# Trouver les fichiers > 5MB dans le staging
large_files=$(git diff --cached --name-only --diff-filter=ACM | while read file; do
  if [ -f "$file" ]; then
    size=$(wc -c < "$file" 2>/dev/null || echo 0)
    if [ "$size" -gt 5242880 ]; then  # 5MB
      echo "$file ($(numfmt --to=iec-i --suffix=B $size 2>/dev/null || echo "${size}B"))"
    fi
  fi
done)

if [ -n "$large_files" ]; then
  echo "âš ï¸  ATTENTION: Fichiers volumineux dÃ©tectÃ©s:"
  echo "$large_files"
  echo ""
  echo "Ces fichiers sont > 5MB. ÃŠtes-vous sÃ»r de vouloir les commiter?"
  echo "ConsidÃ©rez utiliser Git LFS ou les exclure du dÃ©pÃ´t."
  echo ""
  read -p "Continuer quand mÃªme? (y/N) " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "âŒ Commit annulÃ©"
    exit 1
  fi
fi

# Nettoyer les fichiers temporaires avant commit
find . -name ".DS_Store" -type f -delete 2>/dev/null || true

echo "âœ… VÃ©rification terminÃ©e"
