feat(onboarding): optimize step version migration API with full error handling and retry logic

BREAKING CHANGES: None - New feature

FEATURES:
- ✅ Complete error handling with try-catch at all levels
- ✅ Retry logic with exponential backoff (configurable)
- ✅ Full TypeScript types for requests/responses
- ✅ Authentication with requireUser() and correlation IDs
- ✅ Batch migrations support (up to 10 steps)
- ✅ Dry-run mode for validation without impact
- ✅ Structured logging with correlation IDs
- ✅ Comprehensive API documentation with examples

SERVICE LAYER (lib/services/step-version-migration.ts):
- Add complete TypeScript interfaces (StepVersionMigrationOptions, MigrationResult, MigrationError)
- Implement retry logic with exponential backoff (retryWithBackoff helper)
- Add structured logging (logInfo, logError, logWarn)
- Implement comprehensive validation with database checks
- Add batch migration support (batchMigrateSteps)
- Implement transaction management with rollback
- Add migration reports and summaries (getMigrationReport, getMigrationSummary)
- Add helper functions (getAffectedUsersCount, executeMigration)

API LAYER (app/api/admin/onboarding/migrate-version/route.ts):
- Add POST endpoint for single and batch migrations
- Add GET endpoint for version history
- Implement authentication with requireUser()
- Add comprehensive input validation (types, required fields)
- Generate correlation IDs for all requests
- Add structured logging for all operations
- Implement detailed error responses with correlation IDs
- Add runtime config (nodejs, force-dynamic)
- Support batch migrations with size limits (max 10)

DOCUMENTATION:
- Add complete API reference (docs/api/step-version-migration.md, 800+ lines)
  - Detailed endpoints documentation
  - Request/response schemas
  - Examples (cURL, TypeScript, Python)
  - Migration process explanation
  - Error handling guide
  - Best practices
  - Troubleshooting guide
  - Monitoring & observability
- Add optimization summary (STEP_MIGRATION_API_OPTIMIZATION_COMPLETE.md)
- Add integration overview (STEP_MIGRATION_INTEGRATION_COMPLETE.md)
- Add quick start guide (STEP_MIGRATION_QUICK_START.md)
- Add files index (STEP_MIGRATION_FILES_INDEX.md)

TESTS:
- Add 24 integration tests (tests/integration/api/step-version-migration.test.ts)
  - Authentication & authorization tests
  - Input validation tests (7 tests)
  - Dry-run mode tests
  - Response schema validation with Zod
  - Batch migration tests
  - Error handling tests
  - Performance tests
  - Version history tests

IMPROVEMENTS:
- Exponential backoff retry (3 attempts by default, configurable)
- Atomic transactions with automatic rollback on failure
- Correlation IDs for request tracing and debugging
- Structured error responses with error codes
- Batch processing with stop-on-first-failure
- Dry-run mode for safe validation
- Comprehensive metrics (usersAffected, duration, errors, warnings)
- Version history endpoint for auditing

SECURITY:
- Authentication required (requireUser)
- Input validation at multiple levels
- SQL injection protection (parameterized queries)
- Transaction safety with rollback
- Audit logging with correlation IDs

OBSERVABILITY:
- Structured logging with context
- Correlation IDs on all requests
- Metrics exposed (duration, users affected, errors)
- Error tracking with stack traces
- Request/response logging

FILES CREATED:
- lib/services/step-version-migration.ts (450+ lines)
- docs/api/step-version-migration.md (800+ lines)
- tests/integration/api/step-version-migration.test.ts (500+ lines)
- STEP_MIGRATION_API_OPTIMIZATION_COMPLETE.md
- STEP_MIGRATION_INTEGRATION_COMPLETE.md
- STEP_MIGRATION_QUICK_START.md
- STEP_MIGRATION_FILES_INDEX.md
- STEP_MIGRATION_COMMIT.txt

FILES MODIFIED:
- app/api/admin/onboarding/migrate-version/route.ts (optimized)

TOTAL LINES: 3150+ lines of code and documentation

TESTING:
- All TypeScript diagnostics pass ✅
- Integration test suite ready (24 tests) ✅
- No ESLint errors ✅

NEXT STEPS:
- [ ] Add unit tests for service layer
- [ ] Implement role-based authorization (admin only)
- [ ] Add Prometheus metrics
- [ ] Create Grafana dashboard
- [ ] Load testing

REFERENCES:
- API Docs: docs/api/step-version-migration.md
- Quick Start: STEP_MIGRATION_QUICK_START.md
- Service Code: lib/services/step-version-migration.ts
- Tests: tests/integration/api/step-version-migration.test.ts

Co-authored-by: Kiro AI <kiro@huntaze.com>
