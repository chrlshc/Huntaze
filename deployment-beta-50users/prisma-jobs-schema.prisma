// Prisma Schema Extension for Azure Workers Job Tracking
// Add these models to your existing prisma/schema.prisma

// Video Analysis Jobs
model VideoAnalysisJob {
  id          String   @id @default(cuid())
  creatorId   Int
  creator     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  
  // Job details
  videoUrl    String
  videoId     String?
  
  // Status tracking
  status      JobStatus @default(PENDING)
  progress    Int       @default(0)
  
  // Results
  result      Json?     // Stores analysis results
  error       Json?     // Stores error details
  
  // Metadata
  attempt     Int       @default(0)
  maxAttempts Int       @default(3)
  deadlineMs  Int       @default(120000) // 2 minutes
  
  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  startedAt   DateTime?
  completedAt DateTime?
  
  @@index([creatorId])
  @@index([status])
  @@index([createdAt])
}

// Chat Suggestions Jobs
model ChatSuggestionsJob {
  id          String   @id @default(cuid())
  creatorId   Int
  creator     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  
  // Job details
  fanMessage  String
  context     Json?
  
  // Status tracking
  status      JobStatus @default(PENDING)
  
  // Results
  result      Json?     // Array of suggestions
  error       Json?
  
  // Metadata
  attempt     Int       @default(0)
  maxAttempts Int       @default(5)
  deadlineMs  Int       @default(90000) // 90 seconds
  
  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  
  @@index([creatorId])
  @@index([status])
  @@index([createdAt])
}

// Content Suggestions Jobs
model ContentSuggestionsJob {
  id          String   @id @default(cuid())
  creatorId   Int
  creator     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  
  // Job details
  contentType String   // post, message, ppv, story
  tone        String   // seductive, playful, romantic, bold, mysterious
  topic       String?
  
  // Status tracking
  status      JobStatus @default(PENDING)
  
  // Results
  result      Json?     // Generated content suggestions
  error       Json?
  
  // Metadata
  attempt     Int       @default(0)
  maxAttempts Int       @default(5)
  deadlineMs  Int       @default(90000)
  
  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  
  @@index([creatorId])
  @@index([status])
  @@index([createdAt])
}

// Content Analysis Jobs
model ContentAnalysisJob {
  id          String   @id @default(cuid())
  creatorId   Int
  creator     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  
  // Job details
  contentId   String
  contentType String
  contentUrl  String
  
  // Status tracking
  status      JobStatus @default(PENDING)
  
  // Results
  result      Json?     // Analysis results
  error       Json?
  
  // Metadata
  attempt     Int       @default(0)
  maxAttempts Int       @default(8)
  deadlineMs  Int       @default(120000)
  
  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  
  @@index([creatorId])
  @@index([status])
  @@index([createdAt])
}

// Job Status Enum
enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  TIMEOUT
}

// Job Events (for audit trail)
model JobEvent {
  id        String   @id @default(cuid())
  jobId     String
  jobType   String   // video.analysis, chat.suggest, content.suggest, content.analyze
  creatorId Int
  
  // Event details
  status    JobStatus
  progress  Int      @default(0)
  message   String?
  
  // Results/Errors
  result    Json?
  error     Json?
  
  // Metadata
  metadata  Json?
  
  // Timestamp
  createdAt DateTime @default(now())
  
  @@index([jobId])
  @@index([creatorId])
  @@index([jobType])
  @@index([createdAt])
}

// Azure AI Cost Tracking
model AzureAICost {
  id            String   @id @default(cuid())
  creatorId     Int
  creator       User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  
  // Model details
  model         String   // deepseek-v3, deepseek-r1, phi-4-multimodal, etc.
  jobType       String?  // video.analysis, chat.suggest, etc.
  
  // Token usage
  inputTokens   Int
  outputTokens  Int
  totalTokens   Int
  
  // Cost
  costUsd       Float
  
  // Metadata
  metadata      Json?
  
  // Timestamp
  createdAt     DateTime @default(now())
  
  @@index([creatorId])
  @@index([model])
  @@index([createdAt])
}

// Service Bus Metrics
model ServiceBusMetrics {
  id                    String   @id @default(cuid())
  
  // Topic/Subscription
  topicName             String
  subscriptionName      String?
  
  // Metrics
  activeMessages        Int      @default(0)
  deadLetterMessages    Int      @default(0)
  scheduledMessages     Int      @default(0)
  transferMessages      Int      @default(0)
  
  // Throughput
  incomingMessages      Int      @default(0)
  outgoingMessages      Int      @default(0)
  
  // Timestamp
  timestamp             DateTime @default(now())
  
  @@index([topicName])
  @@index([subscriptionName])
  @@index([timestamp])
}
